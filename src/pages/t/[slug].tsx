import { useRouter } from 'next/router'; import useSWR from 'swr'; import { useState } from 'react'; const f=(u:string)=>fetch(u).then(r=>r.json()); export default function T(){ const {slug}=useRouter().query; const {data,mutate}=useSWR(slug?`/api/tickets/${slug}`:null,f,{refreshInterval:2000}); const trade=data?.trade; const [cash,setCash]=useState(''); const [credit,setCredit]=useState(''); const patch=async(b:any)=>{await fetch(`/api/trades/${trade.id}`,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(b)}); mutate();}; const ready=async()=>{await fetch(`/api/trades/${trade.id}/ready`,{method:'POST'}); mutate();}; const cashPay=async()=>{await fetch(`/api/trades/${trade.id}/pay_cash`,{method:'POST'}); mutate();}; const creditPay=async()=>{const r=await fetch(`/api/trades/${trade.id}/pay_credit`,{method:'POST'}).then(r=>r.json()); if(r.error) alert(r.error); mutate();}; if(!trade) return <div style={{padding:20}}>Loading...</div>; return (<div style={{padding:20}}><h1>Ticket #{String(trade.queue_number).padStart(3,'0')}</h1><div>{trade.customer_name||'Guest'}</div><div>Status: {trade.status}</div><div style={{marginTop:10}}><input placeholder='Cash $' value={cash} onChange={e=>setCash(e.target.value)} /> <input placeholder='Credit $' value={credit} onChange={e=>setCredit(e.target.value)} /> <button onClick={()=>patch({cash_value_cents:Math.round((parseFloat(cash)||0)*100),credit_value_cents:Math.round((parseFloat(credit)||0)*100)})}>Save</button> <button onClick={ready}>Mark READY</button></div>{trade.status==='READY'&&(<div style={{marginTop:10}}><button onClick={cashPay}>Pay CASH</button> <button onClick={creditPay}>Add STORE CREDIT</button></div>)}</div>); }
